# Experiment Constraint Template
# Use: /manifold:m0-init <experiment> --template=pm/experiment
# Covers: A/B tests, feature experiments, pricing experiments, UX experiments

schema_version: 3
feature: "[CUSTOMIZE: your-experiment-name]"
outcome: "[CUSTOMIZE: e.g., 'Determine if new checkout flow increases conversion by 10%+ with 95% confidence']"
phase: INITIALIZED
template: pm/experiment
template_version: 1

# =============================================================================
# CONSTRAINTS - Customize these for your specific experiment
# =============================================================================

constraints:
  business:
    - id: B1
      type: invariant
      statement: "Experiment must not cause measurable revenue loss during test period"
      rationale: "Protect business while learning; use holdout groups and monitoring"

    - id: B2
      type: goal
      statement: "[CUSTOMIZE: Primary hypothesis, e.g., 'New flow increases conversion by 10%']"
      rationale: "Clear hypothesis enables decisive action on results"

    - id: B3
      type: boundary
      statement: "Experiment duration: [CUSTOMIZE: 2-4 weeks] to reach statistical significance"
      rationale: "Balance between speed and validity; avoid peeking"

    - id: B4
      type: goal
      statement: "Minimum detectable effect: [CUSTOMIZE: 5%] improvement to justify rollout"
      rationale: "Define what 'success' means before seeing results"

  technical:
    - id: T1
      type: invariant
      statement: "Random assignment must be consistent per user across sessions"
      rationale: "Inconsistent assignment invalidates results and confuses users"

    - id: T2
      type: boundary
      statement: "Sample size requirement: [CUSTOMIZE: 10,000] users per variant minimum"
      rationale: "Statistical power requirement for detecting MDE"

    - id: T3
      type: boundary
      statement: "Instrumentation must capture [CUSTOMIZE: primary + 2 secondary] metrics"
      rationale: "Avoid post-hoc metric selection; pre-register what matters"

    - id: T4
      type: goal
      statement: "Experiment infrastructure should support early stopping if guardrails breached"
      rationale: "Limit exposure to harmful variants"

  user_experience:
    - id: U1
      type: invariant
      statement: "Treatment must not degrade core user experience below [CUSTOMIZE: baseline NPS - 5 points]"
      rationale: "Experiments should improve or neutral, not harm users"

    - id: U2
      type: boundary
      statement: "Users must not be aware they are in an experiment (unless required)"
      rationale: "Observer effect invalidates behavioral data"

    - id: U3
      type: goal
      statement: "Treatment provides at least equivalent task completion capability"
      rationale: "Don't block users from accomplishing their goals"

  security:
    - id: S1
      type: invariant
      statement: "Experiment data must be handled per [CUSTOMIZE: GDPR/privacy policy]"
      rationale: "Experimentation data is still personal data"

    - id: S2
      type: boundary
      statement: "Experiment must be documented in experiment registry before launch"
      rationale: "Auditability and prevents p-hacking"

    - id: S3
      type: goal
      statement: "Minimize data retention to experiment duration + [CUSTOMIZE: 90 days]"
      rationale: "Data minimization principle"

  operational:
    - id: O1
      type: invariant
      statement: "Monitoring must alert if treatment shows [CUSTOMIZE: >10%] degradation in guardrail metrics"
      rationale: "Automatic protection against harmful experiments"

    - id: O2
      type: boundary
      statement: "Rollback capability must exist within [CUSTOMIZE: 1 hour] of issue detection"
      rationale: "Limit blast radius of failed experiments"

    - id: O3
      type: goal
      statement: "Analysis report ready within [CUSTOMIZE: 3 days] of experiment end"
      rationale: "Timely decisions while context is fresh"

# =============================================================================
# COMMON TENSIONS - Typical conflicts in experiments
# =============================================================================

tensions:
  - id: TN1
    type: trade_off
    between: [B3, T2]
    description: "Shorter duration (B3) vs sample size requirements (T2)"
    status: unresolved
    resolution: "[CUSTOMIZE: Consider traffic allocation or accepting larger MDE]"
    priority: 1

  - id: TN2
    type: trade_off
    between: [B4, U1]
    description: "Detecting small effects (B4) requires larger exposure to potentially worse UX (U1)"
    status: unresolved
    resolution: "[CUSTOMIZE: Define acceptable risk vs learning value]"
    priority: 2

  - id: TN3
    type: hidden_dependency
    between: [T3, O3]
    description: "Rich instrumentation (T3) requires analysis capacity (O3)"
    status: unresolved
    resolution: "[CUSTOMIZE: Pre-define analysis plan and owner]"
    priority: 3

# =============================================================================
# REQUIRED TRUTHS - What must be true for valid experiment
# =============================================================================

anchors:
  required_truths:
    - id: RT-1
      statement: "Hypothesis and success criteria documented before launch"
      status: NOT_SATISFIED
      priority: 1
      maps_to_constraints: [B2, B4]

    - id: RT-2
      statement: "Randomization is unbiased and verifiable"
      status: NOT_SATISFIED
      priority: 1
      maps_to_constraints: [T1, T2]

    - id: RT-3
      statement: "Guardrail metrics are monitored with alerting"
      status: NOT_SATISFIED
      priority: 1
      maps_to_constraints: [O1, U1]

    - id: RT-4
      statement: "Analysis owner and timeline are assigned"
      status: NOT_SATISFIED
      priority: 2
      maps_to_constraints: [O3, TN3]

# =============================================================================
# CUSTOMIZATION NOTES
# =============================================================================

_customization:
  required_changes:
    - "Replace [CUSTOMIZE: ...] values with your specific requirements"
    - "Define clear hypothesis in B2"
    - "Calculate sample size for T2 based on baseline conversion and MDE"
    - "Set appropriate experiment duration in B3"
    - "Identify guardrail metrics for O1"

  optional_additions:
    - "Add segmentation constraints (mobile vs desktop, new vs returning)"
    - "Add geo constraints if regional experiment"
    - "Add exclusion criteria (e.g., exclude power users)"
    - "Add novelty effect considerations for long-term experiments"

  common_removals:
    - "Remove S3 if standard data retention policy applies"
    - "Remove U2 if disclosure is required (medical, financial)"

# =============================================================================
# PHASE TRACKING
# =============================================================================

iterations: []

convergence:
  status: NOT_STARTED
  criteria: []
