# CRUD Operations Constraint Template
# Use: /m0-init <feature> --template=crud
# Covers: Create, Read, Update, Delete operations on data entities

schema_version: 3
feature: "[CUSTOMIZE: your-entity-name]-management"
outcome: "[CUSTOMIZE: e.g., 'Reliable CRUD operations for user profiles with <100ms response']"
phase: INITIALIZED
template: crud
template_version: 1

# =============================================================================
# CONSTRAINTS - Customize these for your specific CRUD needs
# =============================================================================

constraints:
  business:
    - id: B1
      type: invariant
      statement: "Data must maintain referential integrity across all operations"
      rationale: "Orphaned or inconsistent data causes application errors and data quality issues"

    - id: B2
      type: boundary
      statement: "[CUSTOMIZE: Entity] records must support soft delete with recovery window of [CUSTOMIZE: 30] days"
      rationale: "Enables data recovery and compliance with retention policies"

    - id: B3
      type: goal
      statement: "Bulk operations should support [CUSTOMIZE: 1000]+ records per request"
      rationale: "Enables efficient data migration and batch processing"

  technical:
    - id: T1
      type: invariant
      statement: "All write operations must be idempotent or use idempotency keys"
      rationale: "Prevents duplicate records from network retries"

    - id: T2
      type: boundary
      statement: "Read operations must complete in <[CUSTOMIZE: 100]ms at p95"
      rationale: "User experience degrades significantly above this threshold"

    - id: T3
      type: boundary
      statement: "Write operations must complete in <[CUSTOMIZE: 500]ms at p95"
      rationale: "Acceptable latency for data modification operations"

    - id: T4
      type: goal
      statement: "List operations should support pagination with cursor-based navigation"
      rationale: "Enables efficient handling of large datasets"

  user_experience:
    - id: U1
      type: boundary
      statement: "Validation errors must be returned with field-level specificity"
      rationale: "Users need to know exactly what to fix"

    - id: U2
      type: goal
      statement: "Create/Update operations should return the complete updated entity"
      rationale: "Avoids additional fetch request after modification"

    - id: U3
      type: boundary
      statement: "Delete confirmation must be required for destructive operations"
      rationale: "Prevents accidental data loss"

  security:
    - id: S1
      type: invariant
      statement: "All CRUD operations must enforce authorization checks"
      rationale: "Users should only access/modify their own data or authorized resources"

    - id: S2
      type: invariant
      statement: "Input must be validated and sanitized before database operations"
      rationale: "Prevents SQL injection and data corruption"

    - id: S3
      type: goal
      statement: "Audit trail should capture who modified what and when"
      rationale: "Enables investigation and compliance reporting"

  operational:
    - id: O1
      type: boundary
      statement: "Database connections must be pooled with max [CUSTOMIZE: 100] connections"
      rationale: "Prevents connection exhaustion under load"

    - id: O2
      type: goal
      statement: "Failed operations should be retryable with exponential backoff"
      rationale: "Improves reliability during transient failures"

# =============================================================================
# COMMON TENSIONS - Typical conflicts in CRUD systems
# =============================================================================

tensions:
  - id: TN1
    type: trade_off
    between: [T2, S3]
    description: "Fast reads (T2) vs audit logging (S3)"
    status: resolved
    resolution: "Async audit logging to separate store; read path unaffected"
    priority: 1

  - id: TN2
    type: trade_off
    between: [B2, T1]
    description: "Soft delete (B2) vs idempotency (T1) - delete then create same ID?"
    status: resolved
    resolution: "Soft delete uses timestamp; new records get new IDs; restore uses original ID"
    priority: 2

  - id: TN3
    type: resource_tension
    between: [B3, O1]
    description: "Bulk operations (B3) vs connection pool limits (O1)"
    status: unresolved
    resolution: "[CUSTOMIZE: Consider batch processing with queue]"
    priority: 3

# =============================================================================
# REQUIRED TRUTHS - What must be true for CRUD to work
# =============================================================================

anchors:
  required_truths:
    - id: RT-1
      statement: "Entity can be uniquely identified by ID"
      status: NOT_SATISFIED
      priority: 1
      maps_to_constraints: [T1, S1]

    - id: RT-2
      statement: "Valid entity state can be distinguished from invalid state"
      status: NOT_SATISFIED
      priority: 1
      maps_to_constraints: [U1, S2]

    - id: RT-3
      statement: "Entity lifecycle (create→update→delete) is well-defined"
      status: NOT_SATISFIED
      priority: 2
      maps_to_constraints: [B1, B2]

# =============================================================================
# CUSTOMIZATION NOTES
# =============================================================================

_customization:
  required_changes:
    - "Replace [CUSTOMIZE: Entity] with your specific entity name"
    - "Adjust latency thresholds (T2, T3) based on SLA requirements"
    - "Configure soft delete retention period (B2)"
    - "Set connection pool size (O1) based on infrastructure"

  optional_additions:
    - "Versioning/conflict detection for concurrent updates"
    - "Field-level permissions"
    - "Data encryption at rest"
    - "Multi-tenancy constraints"
    - "Cascading delete rules"

  common_removals:
    - "Remove soft delete (B2) if hard delete is acceptable"
    - "Remove bulk operations (B3) if not needed"
    - "Remove audit trail (S3) if not required by compliance"
