# Integration Analysis for: schema-enforcement
# Generated by /manifold:m6-integrate on 2026-01-19

schema_version: 1
feature: schema-enforcement
phase: VERIFIED

integration:
  timestamp: "2026-01-19T03:00:00Z"
  iteration: 6
  feature: schema-enforcement

# ════════════════════════════════════════════════════════════════════
# ARTIFACT INVENTORY
# ════════════════════════════════════════════════════════════════════

artifacts:
  generated:
    - path: cli/lib/schema.ts
      status: modified
      new_exports:
        - sanitizePath
        - validateEvidence (internal)
        - validateConstraintGraph (internal)
        - validateReferences (internal)
      integrated: true
      notes: "Called by validateManifold() internally"

    - path: cli/commands/validate.ts
      status: modified
      new_exports: []
      integrated: true
      notes: "--all flag added, already wired to CLI"

    - path: cli/lib/solver.ts
      status: modified
      new_exports:
        - detectSemanticConflicts
        - formatConflictResults
        - SemanticConflict (type)
        - ConflictDetectionResult (type)
      integrated: false
      notes: "Functions exported but NOT used by any CLI command"

    - path: install/commands/SCHEMA_REFERENCE.md
      status: modified
      new_exports: []
      integrated: true
      notes: "Documentation, no code integration needed"

    - path: cli/__tests__/schema.test.ts
      status: extended
      new_exports: []
      integrated: true
      notes: "Tests run via 'bun test'"

    - path: cli/__tests__/solver-conflicts.test.ts
      status: created
      new_exports: []
      integrated: true
      notes: "Tests run via 'bun test'"

# ════════════════════════════════════════════════════════════════════
# INTEGRATION CHECKLIST
# ════════════════════════════════════════════════════════════════════

checklist:
  - id: INT-1
    priority: HIGH
    status: completed
    completed_at: "2026-01-19T03:15:00Z"
    source: cli/lib/solver.ts
    target: cli/commands/validate.ts
    action: "Wire detectSemanticConflicts() into CLI"
    details:
      - "Added --conflicts flag to validate command"
      - "Import detectSemanticConflicts and formatConflictResults from solver.js"
      - "Call conflict detection in printValidationOutput when flag is set"
    satisfies: [B2, RT-4]
    effort: "~15 lines"
    verification: "manifold validate schema-enforcement --conflicts"

  - id: INT-2
    priority: MEDIUM
    status: pending
    source: cli/lib/solver.ts
    target: install/commands/m2-tension.md
    action: "Document CLI usage of conflict detection in skill file"
    details:
      - "m2-tension skill should mention CLI conflict detection"
      - "Add: 'Use manifold validate --conflicts to check for semantic conflicts'"
    satisfies: [U4]
    effort: "~5 lines"

  - id: INT-3
    priority: LOW
    status: optional
    source: cli/lib/schema.ts
    target: cli/commands/verify.ts
    action: "Add --verify-evidence flag to use sanitizePath validation"
    details:
      - "sanitizePath() is called internally during validation"
      - "verify command could use it for explicit path checking"
      - "Already works via validate; this is an enhancement"
    satisfies: [S2, RT-8]
    effort: "~20 lines"

  - id: INT-4
    priority: LOW
    status: optional
    source: install/commands/SCHEMA_REFERENCE.md
    target: install/install.sh
    action: "Ensure SCHEMA_REFERENCE.md is distributed"
    details:
      - "Check that install script copies the updated file"
      - "May already be handled by existing glob patterns"
    satisfies: [O3]
    effort: "verify only"

# ════════════════════════════════════════════════════════════════════
# INTEGRATION ANALYSIS
# ════════════════════════════════════════════════════════════════════

analysis:
  total_points: 4
  blocking: 0      # INT-1 completed
  non_blocking: 3
  completed: 1     # INT-1 done
  auto_wireable: 0
  manual_required: 3

  gaps_from_verify:
    - gap: GAP-1
      description: "AI skill files need v3 updates"
      integration_impact: "No CLI integration needed - skill file updates"

    - gap: GAP-2
      description: "Cross-feature detection deferred"
      integration_impact: "Future work - not part of current scope"

  key_finding: |
    The main integration gap is INT-1: detectSemanticConflicts() is fully implemented
    and tested but has no CLI entry point. Users cannot invoke it from command line.

    Recommendation: Add --conflicts flag to 'manifold validate' command since
    conflict detection is a form of validation and fits naturally there.

# ════════════════════════════════════════════════════════════════════
# RECOMMENDED ACTIONS
# ════════════════════════════════════════════════════════════════════

actions:
  immediate:
    - id: ACTION-1
      target: cli/commands/validate.ts
      description: "Add --conflicts flag to validate command"
      code_snippet: |
        // In ValidateOptions interface:
        conflicts?: boolean;

        // In registerValidateCommand():
        .option('--conflicts', 'Run semantic conflict detection')

        // In validateCommand(), after schema validation:
        if (options.conflicts) {
          const conflictResult = detectSemanticConflicts(parsed);
          println(formatConflictResults(conflictResult));
        }
      imports_needed:
        - "import { detectSemanticConflicts, formatConflictResults } from '../lib/solver.js';"

  optional:
    - id: ACTION-2
      target: install/commands/m2-tension.md
      description: "Add CLI conflict detection reference"
      content: |
        ## CLI Conflict Detection

        For programmatic conflict detection, use the CLI:

        ```bash
        manifold validate <feature> --conflicts
        ```

# ════════════════════════════════════════════════════════════════════
# SUMMARY
# ════════════════════════════════════════════════════════════════════

summary:
  status: SATISFIED
  blocking_integrations: 0
  completed_integrations: 1
  message: |
    Schema-enforcement artifacts are fully integrated. INT-1 (conflict detection CLI)
    was completed by adding --conflicts flag to validate command. Remaining integration
    points are non-blocking documentation enhancements.

  completed:
    - "INT-1: Added 'manifold validate --conflicts' command"

  next_steps:
    - "Optional: Apply INT-2 to document CLI conflict detection in m2-tension.md"
    - "Optional: Apply INT-3 to add --verify-evidence flag"
